# Create Ethos App

This section describes the steps to create a new app from scratch starting from an application generated by `create react app`.

The example create an app called `ethos-sample`

## Create a new app

Create a new app using Create react app:

```js
  npx create-react-app ethos-sample
```

Start the app

```js
  npm start
```

## 0 - Cleanup and install the `core` module

First of all add the `core` module

```js
  npm i --save @ethereansos/interfaces-core
```

and clean up the App.js file:

```js
<div className="App">Sample test</div>
```

You can find more about the `core` module [here](/core).

## 1 - Context load and app initialization

Every app requires a `context` file that defines properties, contracts, etc.
This file is not part of the app and should be loaded dynamically at bootstrap time.

```json
// A sample of the context.json
{
  "ethereumNetwork": {
    "1": "",
    "3": "Ropsten"
  },
  "dappVersion": "BETA 0.3",
  "etherscanURL": "https://etherscan.io/",
  "etherscanURLRopsten": "https://ropsten.etherscan.io/",
  "uniSwapInfoURL": "https://uniswap.info/token/",
  "uniSwapSwapURLTemplate": "https://app.uniswap.org/#/swap?inputCurrency={0}&outputCurrency={1}",
  "penSwapSwapURLTemplate": "https://penguinswap.eth.link/#/swap?inputCurrency={0}&outputCurrency={1}",
  "uniSwapPoolURLTemplate": "https://app.uniswap.org/#/pool?inputCurrency={0}&outputCurrency={1}",
  ...
  "oneTimeProposalTemplate": [
    "contract DFOHubGeneratedProposal {",
    "",
    "    string private _metadataLink;",
    "",
    "    constructor(string memory metadataLink) {",
    "        _metadataLink = metadataLink;",
    "    }",
    "",
    "    function getMetadataLink() public view returns(string memory) {",
    "        return _metadataLink;",
    "    }",
    "",
    "    function callOneTime(address proposal) public {",
    "function_body",
    "    }",
    "}"
  ]
}
```

### InitContextProvider

To load and share in the app the `context` it's required to add to the app the `InitContextProvider`.

```js
import { InitContextProvider } from '@ethereansos/interfaces-core'

function App() {
  return (
    <InitContextProvider>
      <div className="App">Hello world!</div>
    </InitContextProvider>
  )
}
```

The provider requires a `initMethod` props to do the initialization.
The props expect an async function that inject the `setReady` and the `setValue` method to allow the finalization of the `context` loading.

```js
<InitContextProvider
  initMethod={async ({ setReady, setValue }) => {
    try {
      // Fetch the context
      const response = await fetch(
        `${process.env.PUBLIC_URL}/data/context.json`
      )
      const context = await response.json()

      // Set the value of the context
      setValue('context', context)

      // Set the initialization ready
      setReady()
    } catch (e) {
      // Set the error
      setError('Context not loaded')
    }
  }}>
  <div className="App">Hello world!</div>
</InitContextProvider>
```

Duting the application initialization the component shows the content of the `Loading` property and if it fails shows the `Error` property content.

```js
    <InitContextProvider
      initMethod={async ({ setReady, setValue }) => {
            // Fetch the context
           ...
      }}
      Loading={() => <div>Loading..</div>}
      Error={({ error }) => <div>Error..{error}</div>}
    >
      <div className="App">Hello world!</div>
    </InitContextProvider>
```

### useEthosContext

The `context` is exposed to the app with the hook `useEthosContext`

Create a ContextViewer component

```js
const ContextViewer = () => {
  const context = useEthosContext()
  return <pre>{JSON.stringify(context, null, 2)}</pre>
}
```

Add the component to the app

```js
    <InitContextProvider
      initMethod={async ({ setReady, setValue }) => {
            // Fetch the context
           ...
      }}
      Loading={() => <div>Loading..</div>}
      Error={({ error }) => <div>Error..{error}</div>}
    >
      <div className="App">Hello world!</div>
      <ContextViewer />
    </InitContextProvider>
```

## 2 - Integrate the plugin system

Before starting to configure our plugins, let's import the `PluginsContextProvider` from the `@ethereansos/interfaces-core` module in `App.js`, and create your `plugins.js` file in the root folder and wrap your app.

```js
  import { PluginsContextProvider } from '@ethereansos/interfaces-core'
  import appPlugin from './plugins'

  <InitContextProvider ...>
    <PluginsContextProvider plugins={[appPlugin]}>
      <div className="App">Hello world!</div>
    </PluginsContextProvider>
  </InitContextProvider>
```

The basic configuration of our `plugin.js` file, is:

```js
  const initPlugin = () => {
    ...
  }
  const pluginDefinition = {
    name: 'your-plugin-name',
    init: initPlugin,
  }
  export default pluginDefinition
```

There are severals functions exposed from the `plugins` system.
You can find more about the `plugins` module [here](/plugins).

For the purpose of this tutorial, let's use `addElement()` to add the routes and the app props to for the navigation.

```js
import ExamplePage from './pages/ExamplePage'

const initPlugin = ({ addElement }) => {
  addElement('router', {
    index: 10,
    path: '/example',
    Component: ExamplePage,
    exact: true,
    requireConnection: false,
    templateProps: {
      menuName: 'appMenu',
    },
  })

  addElement('appMenu', {
    name: 'example',
    label: 'Example',
    link: '/example',
    index: 10,
  })
}
```

In this way, your app will expose the routes and custom menu props based on your elements added in the plugins.

## 3 - Add the router

Before starting to configure our router, let's create a `router.js` file in the root filder, and import the `usePlaceholder` from the `@ethereansos/interfaces-core` module.
Be sure that `react-router-dom` is installed also as dependency in the project.

```js
  npm i --save react-router-dom
```

```js
import React, { useMemo } from 'react'
import { Switch, Route } from 'react-router-dom'
import { usePlaceholder } from '@ethereansos/interfaces-core'
import Connect from './components/Connect'
import MainTemplate from './components/MainTemplate'

const NoMatch = () => <div>No Match</div>

const AppRouter = () => {
  const routes = usePlaceholder('router')

  const memoedRoutes = useMemo(() => {
    return routes.map(
      ({ path, exact, Component, requireConnection, templateProps }) => {
        return (
          <Route key={path} path={path} exact={exact}>
            {requireConnection ? (
              <Connect>
                <MainTemplate {...templateProps} Component={Component} />
              </Connect>
            ) : (
              <MainTemplate {...templateProps} Component={Component} />
            )}
          </Route>
        )
      }
    )
  }, [routes])

  return (
    <Switch>
      {memoedRoutes}
      <Route>
        <NoMatch />
      </Route>
    </Switch>
  )
}

export default AppRouter
```

And then import your `<Router />` in your `App.js`.

```js
  import { HashRouter } from 'react-router-dom'
  import AppRouter from './router'

  <InitContextProvider ... >
    <PluginsContextProvider ...>
      <HashRouter>
        <AppRouter />
      </HashRouter>
    </PluginsContextProvider>
  </InitContextProvider>
```

Et voil√†, the app now has dynamic routes, based on your plugins file, and exposes the menu props where you can build your navigation component.

## 4 - Install the `design-system` module

First of all add the `design-system` module

```js
  npm i --save @dfohub/design-system
```

Be sure you create and import `typography.css` and `app.css` in your global `App.js`.
You can find more about the `design-system` module and the global style variables [here](/design).

There are plenty of components to reuse in your application, but in this case we will import our basic `<Typography />` one.

Let's create an `<Navigation />` component and let's use the previous `appMenu` props exposed from the `plugins` system to map the links.

```js
import React from 'react'
import { Link, useLocation } from 'react-router-dom'
import { usePlaceholder } from '@ethereansos/interfaces-core'
import { Typography } from '@dfohub/design-system'

function Navigation({ menuName }) {
  const menuItems = usePlaceholder(menuName)
  const location = useLocation()

  const navItem = (item) => {
    return (
      <Link key={item.name} to={item.link}>
        <Typography variant="body2" color="white">
          {item.label}
        </Typography>
      </Link>
    )
  }

  return <nav>{menuItems.map((item) => navItem(item))}</nav>
}

export default Navigation
```

You will see the navigation links based on your `plugins.js` configuration working smoothly.
